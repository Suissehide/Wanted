var Wanted;!function(o){!function(o){function t(o){this.PayloadContract=o.payloadContract,this.CursorContract=o.cursorContract,this.LeaderboardEntryContract=o.leaderboardEntryContract}t.prototype.DecompressCursor=function(o){return{PositionX:o[this.CursorContract.PositionX],PositionY:o[this.CursorContract.PositionY],Name:o[this.CursorContract.Name],Wins:o[this.CursorContract.Wins],Id:o[this.CursorContract.Id],Disposed:!!o[this.CursorContract.Disposed]}},t.prototype.DecompressLeaderboardEntry=function(o){return{Name:o[this.LeaderboardEntryContract.name],Id:o[this.LeaderboardEntryContract.id],Wins:o[this.LeaderboardEntryContract.wins],Position:0}},t.prototype.DecompressPayload=function(o){return{Cursors:o[this.PayloadContract.cursors],LeaderboardPosition:o[this.PayloadContract.leaderboardPosition],CursorsInWorld:o[this.PayloadContract.cursorsInWorld],Notification:o[this.PayloadContract.notification],LastCommandProcessed:o[this.PayloadContract.lastCommandProcessed]}},t.prototype.DecompressLeaderboard=function(o){for(var t=[],n=0;n<o.length;n++){var e=this.DecompressLeaderboardEntry(o[n]);e.position=n+1,t.push(e)}return t},t.prototype.Decompress=function(o){for(var t=this.DecompressPayload(o),n=0,n=0;n<t.Cursors.length;n++)t.Cursors[n]=this.DecompressCursor(t.Cursors[n]);return t},o.PayloadDecompressor=t}(o.Server||(o.Server={}));o.Server}(Wanted=Wanted||{}),function(o){!function(o){function t(o){this._authCookieName=o}t.prototype.PrepareRegistration=function(){var o=$.cookie(this._authCookieName),o=o?JSON.parse(o):{},t=o.RegistrationId;if(t)return delete o.RegistrationId,$.cookie(this._authCookieName,JSON.stringify(o),{path:"/",expires:30}),{Name:o.DisplayName,RegistrationId:t};throw new Error("Registration Id not available.")},o.ServerConnectionManager=t}(o.Server||(o.Server={}));o.Server}(Wanted=Wanted||{}),function(o){!function(r){function i(o,t){this.Connection=o,this._connectionManager=new r.ServerConnectionManager(t)}i.prototype.Negotiate=function(){var n=this,e=$.Deferred();return this.Wire(),this.Connection.start().then(function(){var t=n._connectionManager.PrepareRegistration();n.TryInitialize(t,function(o){o.UserInformation=t,n._payloadDecompressor=new r.PayloadDecompressor(o.compressionContracts),e.resolve(o),n.Connection.invoke("readyForPayloads")})}),e.promise()},i.prototype.Stop=function(){this.Connection.stop()},i.prototype.TryInitialize=function(t,n,e){void 0===e&&(e=0);var r=this;this.Connection.invoke("initializeClient",t.RegistrationId).then(function(o){o?n(o):i.NEGOTIATE_RETRIES<=e?(console.log("Could not negotiate with server, refreshing the page."),window.location.reload()):setTimeout(function(){r.TryInitialize(t,n,e+1)},i.RETRY_DELAY)})},i.prototype.Wire=function(){var t=this;this.Connection.on("d",function(o){t._payloadDecompressor.Decompress(o)}),this.Connection.on("l",function(o){t._payloadDecompressor.DecompressLeaderboard(o)}),this.Connection.on("disconnect",function(){}),this.Connection.on("controlTransferred",function(){}),this.Connection.on("pingBack",function(){}),this.Connection.on("mapSizeIncreased",function(o){}),this.Connection.on("chatMessage",function(o,t,n){})},i.NEGOTIATE_RETRIES=3,i.RETRY_DELAY=1,r.ServerAdapter=i}(o.Server||(o.Server={}));o.Server}(Wanted=Wanted||{}),function(r){function i(o,t,n){var e=this;i.GameConfiguration=new r.ConfigurationManager(n.Configuration),this._shipManager=new r.ShipManager(this._bufferedViewport,this.Scene,this.CollisionManager,this.Content),this._shipManager.Initialize(new r.UserShipManager(n.ShipId,this._shipManager,this.CollisionManager,this.Input,this.Scene.Camera,t)),this._hud=new r.HUDManager(n,this._shipManager,this._map.AreaRenderer,this.Input.Keyboard,t),t.OnPayload.Bind(function(o){e._shipManager.LoadPayload(o),e._hud.LoadPayload(o)})}i.prototype.LoadContent=function(){},i.prototype.Update=function(o){this._shipManager.Update(o),this._hud.Update(o)},i.prototype.Draw=function(o){},r.Game=i}(Wanted=Wanted||{}),$(function(){var o=(new signalR.HubConnectionBuilder).configureLogging(signalR.LogLevel.Debug).withUrl("http://localhost:5008/hub",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).build(),t=$("#game"),n=($("#popUpHolder"),$("#gameContent")),e=$("#loadContent"),r=new Wanted.Server.ServerAdapter(o,"wanted.state");r.Negotiate().done(function(o){e.hide(),n.show(),game=new Wanted.Game(t[0],r,o)})});